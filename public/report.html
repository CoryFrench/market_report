<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Area Analysis Report</title>
    <link rel="stylesheet" href="/report/styles.css">
    <link rel="icon" type="image/png" href="/report/logo.png">
    <!-- Chart.js for interactive charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script defer src="/report/js/chart-layout.js"></script>
    <!-- Leaflet CSS and JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script defer src="/report/js/report-config.js"></script>
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Development Chart Legend Clickable Styling */
        #dev-comparison-chart + div .chartjs-legend li,
        .chartjs-legend-item {
            cursor: pointer !important;
            transition: all 0.2s ease;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        #dev-comparison-chart + div .chartjs-legend li:hover,
        .chartjs-legend-item:hover {
            background-color: rgba(52, 152, 219, 0.1);
            transform: translateY(-1px);
        }
        
        /* Development Actions Popup */
        #developmentActionsPopup {
            position: fixed !important;
            z-index: 9999 !important;
            display: none !important;
            background: white !important;
            border: 1px solid #ddd !important;
            border-radius: 8px !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
            padding: 12px !important;
            min-width: 160px !important;
            max-width: 200px !important;
        }
        
        #developmentActionsPopup[style*="display: block"] {
            display: block !important;
        }
        
        #developmentActionsPopup button:hover {
            background-color: #f8f9fa !important;
            border-color: #adb5bd !important;
            transform: translateY(-1px) !important;
        }

        /* Custom Development HTML Legend */
        #devLegend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 6px 0 12px 0;
        }
        #devLegend .legend-item {
            background: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 6px 10px;
            min-width: 150px;
            text-align: center;
        }
        #devLegend .legend-name {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #2c3e50;
            cursor: pointer;
        }
        #devLegend .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }
        #devLegend .legend-actions {
            margin-top: 2px;
            font-size: 12px;
            color: #6c757d;
        }
        #devLegend .legend-actions a {
            color: #3498db;
            text-decoration: none;
            margin: 0 4px;
            cursor: pointer;
        }
        #devLegend .legend-actions a:hover {
            text-decoration: underline;
        }

        .market-trends-chart-btn {
            margin-left: 6px;
            background: #ffffff;
            color: var(--accent-color, #1f4f9a);
            border: 1px solid rgba(var(--accent-color-rgb, 31, 79, 154), 0.3);
            border-radius: 999px;
            width: 28px;
            height: 28px;
            font-size: 16px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            line-height: 1;
            box-shadow: 0 4px 12px rgba(var(--primary-color-rgb, 15, 31, 61), 0.12);
        }

        .market-trends-chart-btn:hover,
        .market-trends-chart-btn:focus {
            border-color: var(--accent-color, #1f4f9a);
            color: white;
            background: var(--accent-color, #1f4f9a);
            outline: none;
            transform: translateY(-1px);
        }

        .market-trends-chart-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.75);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 1200;
        }

        .market-trends-chart-modal[aria-hidden="false"] {
            display: flex;
        }

        .market-trends-chart-modal__dialog {
            background: #ffffff;
            width: min(940px, 100%);
            border-radius: 14px;
            padding: 24px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 70px rgba(0,0,0,0.3);
            position: relative;
        }

        .market-trends-chart-modal__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            border-bottom: 1px solid var(--border-color, #dfe4ef);
            padding-bottom: 12px;
            margin-bottom: 16px;
        }

        .market-trends-chart-modal__title {
            margin: 0;
            font-size: 1.25rem;
            color: var(--primary-color, #0f1f3d);
        }

        .market-trends-chart-modal__close {
            border: none;
            background: none;
            font-size: 28px;
            color: var(--muted-color, #5c6770);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .market-trends-chart-modal__close:hover {
            background: rgba(var(--accent-color-rgb, 31, 79, 154), 0.08);
            color: var(--accent-color, #1f4f9a);
        }

        .market-trends-chart-modal__controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 12px;
        }

        .market-trends-chart-modal__metric {
            font-weight: 600;
            color: var(--primary-color, #0f1f3d);
        }

        .market-trends-chart-modal__nav {
            border: 1px solid rgba(var(--accent-color-rgb, 31, 79, 154), 0.3);
            background: #ffffff;
            color: var(--accent-color, #1f4f9a);
            padding: 4px 12px;
            border-radius: 999px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .market-trends-chart-modal__nav:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .market-trends-chart-modal__nav:not(:disabled):hover {
            border-color: var(--accent-color, #1f4f9a);
            color: white;
            background: var(--accent-color, #1f4f9a);
        }

        .market-trends-chart-modal__body {
            flex: 1;
            min-height: 420px;
            position: relative;
        }

        #marketTrendsChartCanvas {
            width: 100%;
            height: 100%;
        }

        .market-trends-chart-modal__status {
            position: absolute;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px;
            color: var(--muted-color, #5c6770);
        }

        .market-trends-chart-modal__status[aria-hidden="false"] {
            display: flex;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="letterhead">
            <div class="header-info">
                <div class="header-item">
                    <div class="header-label">Prepared by</div>
                    <div class="header-value" id="agentName">Agent Name</div>
                    <div class="header-subvalue" id="agentPhone"></div>
                </div>
                <div class="header-logo">
                    <img id="headerLogo" src="/report/logo.png" alt="Logo" />
                </div>
                <div class="header-item">
                    <div class="header-label">Prepared for</div>
                    <div class="header-value" id="buyerName">Buyer Name</div>
                </div>
                <!-- Keep ZIP node in DOM for script compatibility but hide visually -->
                <div class="header-item" id="zipHeaderItem" style="display:none; visibility:hidden;">
                    <div class="header-label">Zip</div>
                    <div class="header-value" id="zipCode">ZIP Code</div>
                </div>
            </div>
        </div>

        <div class="content">
            
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Loading comprehensive market analysis...</p>
            </div>

            <div id="error" class="error" style="display: none;">
                <h3>Analysis Not Found</h3>
                <p>The requested area analysis could not be located. Please verify the report URL.</p>
            </div>
            <div id="reportContent" style="display: none; flex-direction: column; gap: 24px;">

                <div class="section" id="wealth-migration-section" style="order: 6;">
                    <h2>Wealth Migration</h2>
                    <div class="section-content">
                        <div class="wealth-migration-card">
                            <div class="wealth-migration-header">
                                <div class="wealth-migration-summary">
                                    <p class="wealth-migration-eyebrow">Focus County</p>
                                    <div class="wealth-focus-line" id="wealthMigrationFocus">
                                        <label for="wealthMigrationCountySelect" class="sr-only"></label>
                                        <span class="wealth-focus-select-wrapper">
                                            <select id="wealthMigrationCountySelect" class="wealth-focus-select wealth-focus-select--county" disabled>
                                                <option value="">Select a state</option>
                                            </select>
                                        </span>
                                        <span class="wealth-focus-comma">,</span>
                                        <label for="wealthMigrationStateSelect" class="sr-only"></label>
                                        <span class="wealth-focus-select-wrapper">
                                            <select id="wealthMigrationStateSelect" class="wealth-focus-select wealth-focus-select--state"></select>
                                        </span>
                                    </div>
                                    <p class="wealth-migration-subtitle" id="wealthMigrationYear">Awaiting data</p>
                                </div>
                                <div class="wealth-migration-toggle" role="group" aria-label="Select migration direction">
                                    <button type="button" class="wealth-toggle-btn" data-direction="inflow">Inbound</button>
                                    <button type="button" class="wealth-toggle-btn active" data-direction="outflow">Outbound</button>
                                </div>
                            </div>
                            <div class="wealth-migration-body">
                                <div class="wealth-chart-wrapper" id="wealth-migration-chart-container">
                                    <canvas id="wealthMigrationChart" aria-label="Wealth migration chart"></canvas>
                                    <div id="wealthMigrationChartLoading" class="chart-loading-message" style="display:none;">
                                        <div class="loading-spinner-small"></div>
                                        <p>Loading wealth migration insights...</p>
                                    </div>
                                    <div id="wealthMigrationChartFallback" class="chart-empty-state" hidden>
                                        <p>Wealth migration chart is unavailable for this county.</p>
                                    </div>
                                </div>
                <div class="wealth-migration-list" id="wealthMigrationListCard">
                    <h4 id="wealthMigrationListTitle">Top Origins (Counties)</h4>
                    <div class="wealth-migration-scroll" id="wealthMigrationScroll">
                        <ol id="wealthMigrationList" class="wealth-list"></ol>
                        <div id="wealthMigrationListEmpty" class="info-value" style="display:none;">No migration records were found for this direction.</div>
                    </div>
                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section" id="national-section" style="order: 0;">
                    <h2>National Charts</h2>
                    <div class="section-content">
                        <div id="fredChartsContent" style="display: flex; gap: 20px; flex-wrap: wrap;">
                            <div class="chart-container" style="flex: 1; min-width: 300px; border: 1px solid #ddd; border-radius: 8px; padding: 15px;">
                                <div class="chart-headline">
                                    <h3 id="leftChartTitle"><span id="leftChartTitleText">Housing Price Index</span><div id="leftChartSubtitle" class="chart-subtitle">Source: Federal Reserve</div></h3>
                                    <button id="leftInfoIcon" class="chart-info-button" aria-label="What does this mean?">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="12" y1="16" x2="12" y2="12"></line>
                                            <line x1="12" y1="8" x2="12" y2="8"></line>
                                        </svg>
                                    </button>
                                    
                                    <select id="leftChartSelect" class="chart-headline-select">
                                        <option value="DGS2">2-Year Treasury</option>
                                        <option value="DGS10">10-Year Treasury</option>
                                        <option value="MORTGAGE15US">15-Year Mortgage</option>
                                        <option value="MORTGAGE30US">30-Year Mortgage</option>
                                        <option value="ACTLISCOUUS">Active Listings</option>
                                        <option value="CPIAUCSL">CPI</option>
                                        <option value="DJIA">Dow Jones Industrial Average</option>
                                        <option value="LREM64TTUSM156S">Employment</option>
                                        <option value="FEDFUNDS">Fed Funds Rate</option>
                                        <option value="GDP">GDP</option>
                                        <option value="GFDEBTN">Government Debt</option>
                                        <option value="USSTHPI">Housing Price Index</option>
                                        <option value="FPCPITOTLZGUSA">Inflation</option>
                                        <option value="MEDDAYONMARUS">Median Days on Market</option>
                                        <option value="MSPUS">Median Sale Price</option>
                                        <option value="M2REAL">Money Stock</option>
                                        <option value="NEWLISCOUUS">New Listings</option>
                                        <option value="POPTHM">Population</option>
                                        <option value="PPIACO">PPI</option>
                                        <option value="UNRATE">Unemployment Rate</option>
                                        <option value="RHVRUSQ156N">Vacancy Rate</option>
                                    </select>
                                </div>
                                <div style="position: relative; width: 100%; height: 300px; background-color: #f9f9f9; border-radius: 4px;">
                                    <canvas id="leftChart" style="width: 100%; height: 100%;"></canvas>
                                    <div id="leftChart-loading" class="loading-spinner" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                        <div style="border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 2s linear infinite; margin: 0 auto;"></div>
                                        <p style="margin-top: 10px; color: #666;">Loading chart data...</p>
                                    </div>
                                </div>
                                <div id="leftChartDescription" style="display: none;"></div>
                            </div>
                            
                            <div class="chart-container" style="flex: 1; min-width: 300px; border: 1px solid #ddd; border-radius: 8px; padding: 15px;">
                                <div class="chart-headline">
                                    <h3 id="rightChartTitle"><span id="rightChartTitleText">Dow Jones Industrial Average</span><div id="rightChartSubtitle" class="chart-subtitle">Source: Federal Reserve</div></h3>
                                    <button id="rightInfoIcon" class="chart-info-button" aria-label="What does this mean?">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="12" y1="16" x2="12" y2="12"></line>
                                            <line x1="12" y1="8" x2="12" y2="8"></line>
                                        </svg>
                                    </button>
                                    <select id="rightChartSelect" class="chart-headline-select">
                                        <option value="DGS2">2-Year Treasury</option>
                                        <option value="DGS10">10-Year Treasury</option>
                                        <option value="MORTGAGE15US">15-Year Mortgage</option>
                                        <option value="MORTGAGE30US">30-Year Mortgage</option>
                                        <option value="ACTLISCOUUS">Active Listings</option>
                                        <option value="CPIAUCSL">CPI</option>
                                        <option value="DJIA" selected>Dow Jones Industrial Average</option>
                                        <option value="LREM64TTUSM156S">Employment</option>
                                        <option value="FEDFUNDS">Fed Funds Rate</option>
                                        <option value="GDP">GDP</option>
                                        <option value="GFDEBTN">Government Debt</option>
                                        <option value="USSTHPI">Housing Price Index</option>
                                        <option value="FPCPITOTLZGUSA">Inflation</option>
                                        <option value="MEDDAYONMARUS">Median Days on Market</option>
                                        <option value="MSPUS">Median Sale Price</option>
                                        <option value="M2REAL">Money Stock</option>
                                        <option value="NEWLISCOUUS">New Listings</option>
                                        <option value="POPTHM">Population</option>
                                        <option value="PPIACO">PPI</option>
                                        <option value="UNRATE">Unemployment Rate</option>
                                        <option value="RHVRUSQ156N">Vacancy Rate</option>
                                    </select>
                                </div>
                                <div style="position: relative; width: 100%; height: 300px; background-color: #f9f9f9; border-radius: 4px;">
                                    <canvas id="rightChart" style="width: 100%; height: 100%;"></canvas>
                                    <div id="rightChart-loading" class="loading-spinner" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                        <div style="border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 2s linear infinite; margin: 0 auto;"></div>
                                        <p style="margin-top: 10px; color: #666;">Loading chart data...</p>
                                    </div>
                                </div>
                                <div id="rightChartDescription" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section" id="home-section" style="order: 1;">
                    <h2>Home Stats</h2>
                    <div class="section-content">
                        <div id="homeStatsContent" style="display: flex; gap: 40px; min-height: 200px;">
                            <!-- Left Side - Property Information -->
                            <div style="flex: 1; padding: 25px; background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%); border-radius: 12px; border: 1px solid #e9ecef; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                                <div style="margin-bottom: 20px;">
                                    <div id="propertyAddress" style="color: #34495e; font-size: 20px; font-weight: 500; margin-bottom: 8px; line-height: 1.4;">
                                        Loading address...
                                    </div>
                                    <div id="propertyDevelopment" style="color: #7f8c8d; font-size: 18px; margin-bottom: 6px;">
                                        Development information
                                    </div>
                                    <div id="propertySubdivision" style="color: #7f8c8d; font-size: 18px; margin-bottom: 20px;">
                                        Subdivision details
                                    </div>
                                    <!-- Address Lookup (RentCast-backed) -->
                                    <form id="homeLookupForm" class="home-lookup-grid" style="margin-top: 6px;">
                                        <div style="grid-column: 1 / -1;">
                                            <label for="hl_address" style="display:block; font-size:12px; color:#7f8c8d; margin-bottom:4px;">Address</label>
                                            <input id="hl_address" name="address" type="text" placeholder="123 Main St" style="width:100%; padding:10px 12px; border:1px solid #dee2e6; border-radius:8px;" />
                                        </div>
                                        <div>
                                            <label for="hl_city" style="display:block; font-size:12px; color:#7f8c8d; margin-bottom:4px;">City</label>
                                            <input id="hl_city" name="city" type="text" placeholder="City" style="width:100%; padding:10px 12px; border:1px solid #dee2e6; border-radius:8px;" />
                                        </div>
                                        <div>
                                            <label for="hl_state" style="display:block; font-size:12px; color:#7f8c8d; margin-bottom:4px;">State</label>
                                            <input id="hl_state" name="state" type="text" placeholder="FL" style="width:100%; padding:10px 12px; border:1px solid #dee2e6; border-radius:8px;" />
                                        </div>
                                        <div>
                                            <label for="hl_zip" style="display:block; font-size:12px; color:#7f8c8d; margin-bottom:4px;">ZIP</label>
                                            <input id="hl_zip" name="zip" type="text" placeholder="33408" style="width:100%; padding:10px 12px; border:1px solid #dee2e6; border-radius:8px;" />
                                        </div>
                                        <div>
                                            <button type="submit" id="hl_submit" style="width:100%; padding:10px 12px; background:#1e88e5; color:#fff; border:none; border-radius:8px; cursor:pointer;">Lookup</button>
                                        </div>
                                    </form>
                                    <div id="homeLookupResults" style="margin-top: 10px;"></div>
                                </div>
                                
                                <!-- Action Icons -->
                                <div style="display: flex; gap: 15px; padding-top: 15px; border-top: 1px solid #e9ecef;">
                                    <div id="mapButton" style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: #ffffff; border: 1px solid #dee2e6; border-radius: 8px; cursor: pointer; transition: all 0.2s ease;">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#3498db" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                            <circle cx="12" cy="10" r="3"></circle>
                                        </svg>
                                        <span style="color: #3498db; font-size: 13px; font-weight: 500;">Map</span>
                                    </div>
                                    <div id="chartButton" style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: #ffffff; border: 1px solid #dee2e6; border-radius: 8px; cursor: pointer; transition: all 0.2s ease;">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#27ae60" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <line x1="18" y1="20" x2="18" y2="10"></line>
                                            <line x1="12" y1="20" x2="12" y2="4"></line>
                                            <line x1="6" y1="20" x2="6" y2="14"></line>
                                        </svg>
                                        <span style="color: #27ae60; font-size: 13px; font-weight: 500;">Stats</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right Side - Stats -->
                            <div style="flex: 1; padding: 25px; background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); border-radius: 12px; border: 1px solid #e9ecef; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                                <div style="display: flex; align-items: center; justify-content: center; height: 100%; min-height: 150px;">
                                    <div style="text-align: center;">
                                        <h3 style="margin: 0; color: #2c3e50; font-size: 24px; font-weight: 300; letter-spacing: 2px; text-transform: uppercase;">Stats</h3>
                                        <div style="width: 60px; height: 2px; background: linear-gradient(90deg, #3498db, #27ae60); margin: 15px auto;"></div>
                                        <p style="margin: 10px 0 0 0; color: #7f8c8d; font-size: 14px; font-style: italic;">Market analytics coming soon</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section" id="neighbourhood-section" style="order: 2;">
                    <h2 style="text-align: center;">Neighbourhood Charts</h2>
                    <div class="section-content">
                        <!-- Development Comparison Interface -->
                        <div id="developmentComparisonContainer">
                            <div style="border-top: 1px solid #e9ecef; padding-top: 30px;">
                                <h3 id="dev-comp-title" style="text-align: center; color: #2c3e50; margin-bottom: 20px;">Development Comparison Analysis</h3>
                                
                <!-- Development Comparison Controls -->
                <div class="comparison-controls" id="dev-controls-section">
                    <div class="locations-container">
                        <h4 id="dev-controls-title">Development Comparison Analysis</h4>
                        <div id="development-selections">
                            <!-- Dynamic development selectors will be added here -->
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="add-development-btn" class="add-location-btn">Add Development</button>
                        <button id="remove-development-btn" class="remove-location-btn" style="display: none;">Remove Development</button>
                        <button id="compare-developments-btn" class="compare-btn">
                            <span>Generate Analysis</span>
                        </button>
                        <button id="reset-development-comparison-btn" class="reset-btn">Reset to Default</button>
                    </div>
                </div>                                <!-- Development Comparison Chart View -->
                                <div class="chart-section" id="dev-chart-section" style="display: none;">
                                    <div class="chart-controls">
                                        <button id="back-to-dev-controls-btn" class="back-to-controls-btn">← Change Neighbourhood</button>
                                    </div>
                                    <div id="dev-comparison-chart-header" class="chart-header" style="display: none;">
                                        <h3 id="dev-chart-title">Development Sales Comparison</h3>
                                        <p id="dev-chart-subtitle">Comparative analysis of sales volume and pricing across selected developments</p>
                                    </div>
                                    <!-- Custom HTML legend lives OUTSIDE the chart container so it doesn't consume canvas height -->
                                    <div id="devLegend" class="dev-legend-bar"></div>
                                    <div id="development-chart-controls" style="display: none; text-align: center; margin-bottom: 20px;">
                                        <label for="development-chart-type-select" style="margin-right: 10px; font-weight: bold;">Chart Type:</label>
                                        <select id="development-chart-type-select" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; background: white; cursor: pointer; min-width: 150px;">
                                            <option value="sales">Sales Count</option>
                                            <option value="sales_yoy">Sales Count (YoY %)</option>
                                            <option value="price">Average Price</option>
                                            <option value="price_yoy">Average Price (YoY %)</option>
                                            <option value="price_per_sqft">Price Per Square Foot</option>
                                            <option value="price_per_sqft_yoy">Price Per Square Foot (YoY %)</option>
                                        </select>
                                    </div>
                                    <div id="dev-comparison-chart-container" style="position: relative; height: 500px; width: 100%;">
                                        <canvas id="dev-comparison-chart"></canvas>
                                        <div id="dev-chart-loading" class="chart-loading-message" style="display: none;">
                                            <div class="loading-spinner-small"></div>
                                            <p id="dev-chart-loading-text">Generating development comparison analysis...</p>
                                        </div>
                                        <div id="dev-chart-error" class="chart-error-message" style="display: none;">
                                            <p>Comparison temporarily unavailable. Please verify your selections and try again.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ZIP Insights (realtor.com ZIP-level) -->
                <div class="section" id="county-insights-section" style="display: none; order: 4;">
                    <h2>ZIP Insights</h2>
                    <div class="section-content">
                        <div class="chart-section" id="county-insights" style="display: none;">
                            <div class="comparison-controls" id="ci-controls-section" style="margin-bottom: 12px;">
                                <div class="locations-container">
                                    <h4 id="ci-controls-title">ZIP Insights Comparison</h4>
                                    <div id="ci-location-selections"></div>
                                </div>
                                <div class="action-buttons">
                                    <button id="ci-add-location-btn" class="add-location-btn">Add ZIP</button>
                                    <button id="ci-remove-location-btn" class="remove-location-btn" style="display: none;">Remove ZIP</button>
                                    <button id="ci-compare-btn" class="compare-btn">
                                        <span>Generate Insight</span>
                                    </button>
                                </div>
                            </div>
                            <div class="chart-controls" id="ci-chart-controls" style="display:none;">
                                <button id="ci-back-to-controls-btn" class="back-to-controls-btn">← Change ZIPs</button>
                                <div class="chart-indicator-control">
                                    <label for="county-insights-metric-select">Metric:</label>
                                    <select id="county-insights-metric-select" class="fred-select" style="min-width: 200px;">
                                        <option value="avg_listing_price" selected>Average Listing Price</option>
                                        <option value="median_listing_price_proxy">Median Listing Price (proxy)</option>
                                        <option value="avg_price_per_sqft">Average Price per Sq Ft</option>
                                        <option value="avg_days_on_market">Average Days on Market</option>
                                        <option value="active_listing_count">Active Listings</option>
                                        <option value="new_listing_count">New Listings</option>
                                        <option value="pending_ratio">Pending Ratio</option>
                                        <option value="price_increased_share">Price Increased Share</option>
                                        <option value="price_reduced_share">Price Reduced Share</option>
                                    </select>
                                </div>
                            </div>
                            <div id="county-insights-chart-container" style="position: relative; height: 420px; width: 100%; display: none;">
                                <canvas id="county-insights-chart"></canvas>
                                <div id="county-insights-loading" class="chart-loading-message" style="display: none;">
                                    <div class="loading-spinner-small"></div>
                                    <p>Loading ZIP insights…</p>
                                </div>
                                <div id="county-insights-error" class="chart-error-message" style="display: none;">
                                    <p>Insights unavailable for this ZIP at the moment.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section" id="county-section" style="order: 3;">
                    <h2>County Charts</h2>
                    <div class="section-content">
                        <div id="chartsContent">
                            <!-- Premium FRED Comparison Interface -->
                            <div class="fred-comparison-container" style="width: 100%;">
                                <div class="comparison-controls" id="controls-section">
                                    <div class="control-group">
                                        <label for="series-select">Economic Indicator Selection</label>
                                        <select id="series-select" class="fred-select">
                                            <option value="loading">Loading available metrics...</option>
                                        </select>
                                    </div>
                                    
                                    <div class="locations-container">
                                        <h4>Regional Comparison Analysis</h4>
                                        <div id="location-selections">
                                            <!-- Dynamic location selectors will be added here -->
                                        </div>
                                    </div>
                                    
                                    <div class="action-buttons">
                                        <button id="add-location-btn" class="add-location-btn">Add Location</button>
                                        <button id="remove-location-btn" class="remove-location-btn" style="display: none;">Remove Location</button>
                                        <button id="compare-btn" class="compare-btn">
                                            <span>Generate Analysis</span>
                                        </button>
                                        <button id="reset-comparison-btn" class="reset-btn">Reset to Default</button>
                                    </div>
                                </div>
                                
                                <div class="chart-section" id="chart-section" style="display: none;">
                                    <div class="chart-controls">
                                        <button id="back-to-controls-btn" class="back-to-controls-btn">← Change County</button>
                                        <div class="chart-indicator-control" style="margin-left: 20px; display: inline-flex; align-items: center; gap: 10px;">
                                            <label for="chart-series-select" style="font-weight: bold; color: #333;">Indicator:</label>
                                            <select id="chart-series-select" class="fred-select" style="min-width: 200px;">
                                                <option value="">Select Indicator...</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div id="comparison-chart-header" class="chart-header" style="display: none;">
                                        <h3>Comparative Market Analysis</h3>
                                    </div>
                                    <div id="comparison-chart-container" style="position: relative; height: 500px; width: 100%;">
                                        <canvas id="comparison-chart"></canvas>
                                        <div id="chart-loading" class="chart-loading-message" style="display: none;">
                                            <div class="loading-spinner-small"></div>
                                            <p>Generating comprehensive market analysis...</p>
                                        </div>
                                        <div id="chart-error" class="chart-error-message" style="display: none;">
                                            <p>Analysis temporarily unavailable. Please verify your selections and try again.</p>
                                        </div>
                                    </div>
                                    <div id="data-availability-notice" class="data-notice" style="display: none;">
                                        <!-- Professional notice for unavailable data will be inserted here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section" id="market-trends-section" style="order: 5;">
                    <h2>Market Trends</h2>
                    <div class="section-content">
                        <div class="content-wrapper">
                            <h1 class="market-trends-title">Market Trends YTD as of <span id="last-modified-date">Loading...</span></h1>
                            <div id="market-trends-container"></div>
                            <h1 class="market-trends-source-line">
                                Source:
                                <span class="market-trends-source-chip">MLS</span>
                                <select id="property-type" class="property-type">
                                    <option value="waterfront">Single Family Homes</option>
                                    <option value="condos">Condos</option>
                                </select>
                            </h1>
                            <div class="navigation-buttons">
                                <button id="prev-page" class="nav-button prev-button" aria-label="Previous metric">&lt;</button>
                                <div class="market-trends-page-label" id="market-trends-page-label">Price Change</div>
                                <button id="next-page" class="nav-button next-button" aria-label="Next metric">&gt;</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Market Trends Chart Modal -->
        <div id="marketTrendsChartModal" class="market-trends-chart-modal" aria-hidden="true">
            <div class="market-trends-chart-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="marketTrendsChartTitle">
                <div class="market-trends-chart-modal__header">
                    <h3 class="market-trends-chart-modal__title" id="marketTrendsChartTitle">Market Trends Chart</h3>
                    <button id="marketTrendsChartClose" class="market-trends-chart-modal__close" aria-label="Close market trends chart overlay">&times;</button>
                </div>
                <div class="market-trends-chart-modal__controls">
                    <button type="button" id="marketTrendsChartPrev" class="market-trends-chart-modal__nav" aria-label="Previous metric">&lt;</button>
                    <div class="market-trends-chart-modal__metric" id="marketTrendsChartMetricLabel">Median Sale Price</div>
                    <button type="button" id="marketTrendsChartNext" class="market-trends-chart-modal__nav" aria-label="Next metric">&gt;</button>
                </div>
                <div class="market-trends-chart-modal__body">
                    <div class="market-trends-chart-modal__status" id="marketTrendsChartLoading" aria-hidden="false">
                        <div>
                            <div class="loading-spinner-small" style="margin: 0 auto 16px;"></div>
                            <p style="margin: 0; color: #5c6770;">Loading market history...</p>
                        </div>
                    </div>
                    <div class="market-trends-chart-modal__status" id="marketTrendsChartError" aria-hidden="true"></div>
                    <canvas id="marketTrendsChartCanvas" aria-label="Historical market trends chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Chart Overlay -->
        <div id="chartOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
            <div style="background: white; border-radius: 12px; padding: 30px; max-width: 900px; width: 90%; max-height: 80%; overflow-y: auto; position: relative;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px;">
                    <h2 style="margin: 0; color: #2c3e50;" id="chartOverlayTitle">Development Sales Analysis</h2>
                    <button id="closeChartOverlay" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #95a5a6; padding: 5px;">&times;</button>
                </div>
                
                <div id="chartOverlayContent">
                    <div style="text-align: center; padding: 40px;">
                        <div style="border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 2s linear infinite; margin: 0 auto 20px;"></div>
                        <p style="color: #7f8c8d; font-size: 16px;">Loading sales chart data...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Development Actions Popup -->
        <div id="developmentActionsPopup" style="display: none; position: fixed; z-index: 9999; background: white; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); padding: 12px; min-width: 160px; max-width: 200px;">
            <div style="font-size: 14px; font-weight: 600; color: #2c3e50; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #eee;" id="developmentPopupTitle">
                Development Name
            </div>
            <div style="display: flex; flex-direction: column; gap: 8px;">
                <button id="developmentPopupMapBtn" style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #ffffff; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; transition: all 0.2s ease; font-size: 13px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#3498db" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                    </svg>
                    <span style="color: #3498db; font-weight: 500;">View Map</span>
                </button>
                <button id="developmentPopupChartBtn" style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #ffffff; border: 1px solid #dee2e6; border-radius: 6px; cursor: pointer; transition: all 0.2s ease; font-size: 13px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#27ae60" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="20" x2="18" y2="10"></line>
                        <line x1="12" y1="20" x2="12" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                    <span style="color: #27ae60; font-weight: 500;">View Chart</span>
                </button>
            </div>
        </div>

        <div class="footer">
            <div class="footer-content">
                <p>© 2025 Waterfront Properties. All rights reserved.</p>
                <p>This report was compiled by Waterfront Properties and provided exclusively for the intended recipient.</p>
            </div>
        </div>
    </div>
        <script defer src="/report/js/wealth-migration.js"></script>
        <script defer src="/report/js/fred-comparison.js"></script>
        <script defer src="/report/js/development-tools.js"></script>
        <script defer src="/report/js/report-loader.js"></script>
        <script defer src="/report/js/report-market-trends.js"></script>


    <!-- Map Modal -->
    <div id="mapModal" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 10000;
        overflow: hidden;
    ">
        <div style="
            position: relative;
            width: 95%;
            height: 95%;
            margin: 2.5% auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
        ">
            <!-- Modal Header -->
            <div style="
                padding: 20px 30px;
                border-bottom: 1px solid #e9ecef;
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: #f8f9fa;
                border-radius: 12px 12px 0 0;
            ">
                <div>
                    <h2 id="mapTitle" style="margin: 0; color: #2c3e50; font-size: 24px; font-weight: 600;">Development Parcels Map</h2>
                    <p style="margin: 5px 0 0; color: #6c757d; font-size: 14px;" id="mapSubtitle">Loading development data...</p>
                </div>
                <button id="closeMapModal" style="
                    background: none;
                    border: none;
                    font-size: 28px;
                    color: #6c757d;
                    cursor: pointer;
                    padding: 0;
                    width: 40px;
                    height: 40px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 8px;
                    transition: all 0.2s ease;
                " onmouseover="this.style.background='#e9ecef'" onmouseout="this.style.background='none'">
                    ×
                </button>
            </div>

            <!-- Map Container -->
            <div style="flex: 1; position: relative; overflow: hidden;">
                <div id="developmentMap" style="width: 100%; height: 100%;"></div>
                
                <!-- Loading Overlay -->
                <div id="mapLoading" style="
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(255, 255, 255, 0.9);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                ">
                    <div style="text-align: center;">
                        <div style="
                            border: 4px solid #f3f3f3;
                            border-top: 4px solid #3498db;
                            border-radius: 50%;
                            width: 50px;
                            height: 50px;
                            animation: spin 1s linear infinite;
                            margin: 0 auto 20px;
                        "></div>
                        <p id="mapLoadingText" style="margin: 0; color: #2c3e50; font-size: 16px; font-weight: 500;">Loading development parcels...</p>
                    </div>
                </div>

                <!-- Error Message -->
                <div id="mapError" style="
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: white;
                    display: none;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                ">
                    <div style="text-align: center; max-width: 400px; padding: 40px;">
                        <div style="color: #e74c3c; font-size: 48px; margin-bottom: 20px;">🗺️</div>
                        <h3 style="margin: 0 0 15px; color: #2c3e50; font-size: 20px;">Unable to Load Map</h3>
                        <p style="margin: 0; color: #6c757d; font-size: 14px;" id="mapErrorMessage">
                            <span id="mapErrorContext">Could not load parcel data for this development.</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
